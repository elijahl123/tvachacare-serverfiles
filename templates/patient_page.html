{% extends 'base.html' %}
{% load static %}

{% block header %}
    <title>{{ patient.last_name }}, {{ patient.first_name }}</title>
    <link rel="stylesheet" href="{% static 'patient_page.css' %}">
    <script src="{% static 'js/patient_page.js' %}"></script>
{% endblock %}

{% block content %}
    <div class="justify-content-center align-items-center delete-patient d-none"
         style="display: flex;top: 0;left: 0;width: 100vw;height: 100vh;position: fixed;z-index: 1000;background-color: rgba(128,128,128,0.57);">
        <div class="d-flex flex-column"
             style="background-color: white;padding: 50px;border-radius: 5px;box-shadow: 0 0 5px 0 var(--accent-color);">
            <h1 style="color: var(--main-color);font-weight: bold;font-family: 'Open Sans', sans-serif;margin-bottom: 15px;">
                Are
                you sure?</h1>
            <div role="group" class="btn-group">
                <button class="btn btn-secondary" type="button" onclick="closeMenu()"
                        style="border-radius: 5px;margin: 3px;">Cancel
                </button>
                <a class="btn btn-danger d-print-none" role="button" style="border-radius: 5px;margin: 3px;"
                   href="{% url 'delete_patient' patient.slug %}">Delete</a>
            </div>
        </div>
    </div>
    <div class="justify-content-center align-items-center d-none"
         style="overflow: auto;z-index: 99999;top: 0;left: 0;width: 100vw;height: 100vh;position: fixed;background-color: rgba(128,128,128,0.57);filter: blur(0px);"
         id="email-story">
        <form class="d-flex flex-column justify-content-center" method="post" enctype="multipart/form-data"
              style="overflow: auto;max-height: 100vh;background-color: white;padding: 50px;border-radius: 5px;max-width: 600px;width: 100%;position: relative;">
            {% csrf_token %}
            <h1 style="color: var(--main-color);font-weight: bold;font-family: 'Open Sans', sans-serif;margin-bottom: 15px;text-align: center;">
                Email Story</h1>
            <p style="color: var(--main-color); text-align: center">Separate email recipients by commas</p>
            <input type="text" class="form-control" name="to" placeholder="To" required
                   style="font-size: 20px;margin-bottom: 5px;"/>
            <input type="text" class="form-control" name="cc" placeholder="Cc"
                   style="font-size: 20px;margin-bottom: 5px;"/>
            <input type="text" class="form-control" name="bcc" placeholder="Bcc"
                   style="font-size: 20px;margin-bottom: 5px;"/>
            <input type="text" class="form-control" name="name" required placeholder="Your Name"
                   style="font-size: 20px;margin-bottom: 5px;"/>
            <input type="text" class="form-control" name="title" placeholder="Title" style="font-size: 20px;" required/>
            <textarea class="form-control" name="message" placeholder="Other Info..."
                      style="margin: 10px 0;font-size: 20px;"></textarea>
            <div role="group" class="btn-group">
                <button class="btn btn-secondary" onclick="closeStory()" type="button"
                        style="border-radius:5px;margin: 0 2.5px;">Cancel
                </button>
                <button class="btn btn-success" type="submit" style="margin: 0 2.5px;border-radius: 5px;">Send Email
                </button>
            </div>
        </form>
    </div>
    <main style="min-height: 100vh;background: white;">
        <div class="container-fluid" style="background: white; padding: 0 2rem">
            <div class="row">
                <div class="col col-12 col-lg-4 col-xl-3">
                    <div class="row" style="height: 100%;">
                        <div class="col d-flex justify-content-center align-items-center" style="padding: 15px;">
                            <img src="

                                    {% if patient.patient_image %}{{ patient.patient_image.url }}{% else %}{% static 'img/placeholder_patient.png' %}{% endif %}"
                                 style="object-fit: cover;width: 100%;border-radius: 8px;"/>
                        </div>
                        <div class="col d-flex justify-content-center align-items-center" style="padding: 15px;">
                            <img src="

                                    {% if patient.injury_image %}{{ patient.injury_image.url }}{% else %}{% static 'img/placeholder_injury.png' %}{% endif %}"
                                 style="object-fit: cover;width: 100%;border-radius: 8px;"/>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="row" style="height: 100%;">
                        <div class="col d-flex flex-column justify-content-center align-items-center align-items-lg-start"
                             style="padding: 25px;font-family: Raleway, sans-serif;color: slategray;">
                            <h1 class="text-center text-lg-left" style="font-weight: bold;color: var(--dark);">
                                <span style="margin-right: 15px;">{{ patient.first_name }} {{ patient.middle_name|default_if_none:'' }} {{ patient.last_name }}</span>
                                {% if patient.age %}
                                    <span style="color: gray;font-weight: normal;margin-right: 15px;">|</span>
                                    <span style="margin-right: 15px;">{{ patient.age }}</span>
                                {% endif %}
                                {% if patient.gender %}
                                    <span style="color: gray;font-weight: normal;margin-right: 15px;">|</span>
                                    <span style="margin-right: 15px;">{{ patient.gender }}</span>
                                {% endif %}
                            </h1>
                            <h3 style="font-weight: bold;">{{ patient.patient_record_number|default_if_none:'' }}</h3>
                            <h3 style="font-weight: bold;">{{ patient.telephone_number|default_if_none:'' }}</h3>
                        </div>
                        <div class="col d-flex flex-column justify-content-center align-items-center col-12 col-lg-3"
                             style="padding: 15px;">
                            <button class="btn btn-block btn-transparent-primary" type="button" onclick="window.print()"
                                    style="margin-bottom: 10px;font-weight: bold;font-family: Raleway, sans-serif;">
                                Print
                            </button>
                            <button class="btn btn-block btn-transparent-secondary" type="button" onclick="openStory()"
                                    style="margin-bottom: 10px;font-weight: bold;font-family: Raleway, sans-serif;">
                                Email Story
                            </button>
                            {% if not account.can_approve %}
                                <a class="btn btn-block btn-transparent-success"
                                   href="{% url 'edit_patient' patient.slug %}" role="button"
                                   style="margin-bottom: 10px;font-weight: bold;font-family: Raleway, sans-serif;">Edit</a>
                                <button class="btn btn-block btn-transparent-danger" type="button" onclick="openMenu()"
                                        style="font-weight: bold;font-family: Raleway, sans-serif;">Delete
                                </button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <hr/>
            <div class="row">
                <div class="col" style="padding: 15px;">
                    <div class="overflow-auto"
                         style="height: 100%;border-radius: 8px;max-height: calc(100vh - 320px);padding: 1rem;border: 1px solid #dfe1e5;">
                        {% for field, value in fields %}
                            {% if value %}
                                <div class="row no-gutters"
                                     style="font-family: Raleway, sans-serif;border-radius: 8px;background: whitesmoke;margin: 0.5rem 0;">
                                    <div class="col d-flex align-items-center"
                                         style="color: white;background: rgb(252,156,52);border-radius: 8px;">
                                        <h2 style="margin: 1rem;font-weight: bold;">{{ field }}</h2>
                                    </div>
                                    <div class="col d-flex align-items-center">
                                        <h2 style="margin: 1rem;font-weight: normal;color: var(--dark);font-family: 'Open Sans', sans-serif;">{{ value }}</h2>
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- DIVIDER -->

                <div class="col col-12 col-xl-5 col-lg-6" style="padding: 15px;">
                    <div class="overflow-auto"
                         style="height: 100%;border-radius: 8px;padding: 1rem;max-height: calc(100vh - 320px);border:1px solid #dfe1e5">
                        <div class="row no-gutters">
                            <div class="col col-12 d-flex flex-column justify-content-around align-items-center"
                                 style="font-family: Raleway, sans-serif;padding: 1rem 0;">
                                <h3 style="font-weight: bold;color: var(--dark);text-align: center;">Uploaded:</h3>
                                <div class="d-flex flex-column justify-content-center align-items-center"
                                     style="font-family: Raleway, sans-serif;padding: 1rem;width: 150px;height: 150px;color: var(--secondary);background: rgba(108,117,125,0.14);border-radius: 1rem;">
                                    <h4 style="font-weight: bold;margin: 0;">October</h4>
                                    <h1 style="font-weight: bold;margin: 0;">12</h1>
                                    <h4 style="font-weight: bold;margin: 0;">2020</h4>
                                </div>
                            </div>
                            <div class="col col-12 d-flex flex-column justify-content-around align-items-center"
                                 style="font-family: Raleway, sans-serif;padding: 1rem 0;">
                                <h3 style="font-weight: bold;color: var(--dark);text-align: center;">Date of Birth:</h3>
                                <div class="d-flex flex-column justify-content-center align-items-center"
                                     style="font-family: Raleway, sans-serif;padding: 1rem;width: 150px;height: 150px;color: var(--success);background: rgba(40,167,69,0.14);border-radius: 1rem;">
                                    <h4 style="font-weight: bold;margin: 0;">January</h4>
                                    <h1 style="font-weight: bold;margin: 0;">02</h1>
                                    <h4 style="font-weight: bold;margin: 0;">2003</h4>
                                </div>
                            </div>
                        </div>
                        <hr/>
                        <h1 style="font-family: Raleway, sans-serif;font-weight: bold;color: var(--dark);margin-left: 1rem;">
                            Surgeries</h1>
                        {% for surgeries, image in surgery %}
                            <a href="{% url 'surgery_page' patient.slug surgeries.id %}"
                               class="row no-gutters surgery-card"
                               style="background: whitesmoke;border-radius: 8px;margin-top: 1rem;">
                                <div class="col d-flex align-items-center"
                                     style="padding: 1rem;font-family: Raleway, sans-serif;">
                                    <img class="img-fluid" src="

                                            {% if image %}{{ image.image.url }}{% else %}{% static 'img/placeholder_surgery.png' %}{% endif %}"
                                         style="width: 30%;border-radius: 8px;"/>
                                    <div style="margin-left: 1rem;width: 100%;">
                                        <h4 style="font-weight: bold;color: var(--dark)">ID #{{ surgeries.id }}</h4>
                                        <hr style="margin: 8px 0;"/>
                                        <h6 style="font-family: 'Open Sans', sans-serif;color: var(--secondary);font-weight: bold;">{{ surgeries.date_of_upload }}</h6>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                        {% if not account.can_approve %}
                            <a href="{% url 'add_surgery' patient.slug %}"
                               class="btn btn-transparent-tvachacare btn-lg btn-block" style="margin-top: 15px">
                                <i class="fa fa-plus"></i>
                            </a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}